digraph HierarchicalNetwork {
  rankdir=TB;
  ranksep=1.5;
  nodesep=1.0;
  splines=ortho;
  concentrate=false;
  bgcolor=white;
  node [fontname="Arial", fontsize=10];
  edge [fontname="Arial", fontsize=9];

  // Layer 1: Internet
  subgraph cluster_internet {
    rank=source;
    label="Internet";
    style=filled;
    fillcolor="#e6f3ff";
    internet [label="Internet", shape=cloud, style=filled, fillcolor="white"];
  }

  // Layer 2: Gateway Router
  subgraph cluster_gateway {
    rank=same;
    label="Gateway Router";
    style=filled;
    fillcolor="#fff2e6";
    gateway_router [label="Gateway Router\n(Layer 3)", shape=diamond, style=filled, fillcolor="#ffcc99"];
  }

  // Layer 3: Core Networks
  subgraph cluster_core {
    rank=same;
    label="Core Networks";
    style=filled;
    fillcolor="#e6ffe6";
    core_net0 [label="IT-OT Network\n192.168.10.0/24\nEtherNet/IP", shape=ellipse, style=filled, fillcolor="#99ff99"];
  }

  // Layer 4: Aggregation Networks
  subgraph cluster_aggregation {
    rank=same;
    label="Aggregation Networks";
    style=filled;
    fillcolor="#ffe6e6";
    agg_net0 [label="OT Network\n192.168.0.0/24\nEtherNet/IP", shape=ellipse, style=filled, fillcolor="#ff9999"];
    agg_net1 [label="IT-OT Network\n141.81.0.0/24\nEtherNet/IP", shape=ellipse, style=filled, fillcolor="#ff9999"];
    agg_net2 [label="IT-OT Network\n10.1.1.0/24\nEtherNet/IP", shape=ellipse, style=filled, fillcolor="#ff9999"];
    agg_net3 [label="IT-OT Network\n192.168.1.0/24\nEtherNet/IP", shape=ellipse, style=filled, fillcolor="#ff9999"];
  }

  // Layer 6: Computing Servers/Devices
  subgraph cluster_devices {
    rank=sink;
    label="Computing Servers";
    style=filled;
    fillcolor="#f5f5f5";
    device_0 [label="192.168.0.47\nField Device", shape=box, style=filled, fillcolor="#ccffcc"];
    device_1 [label="192.168.10.121\nField Device", shape=box, style=filled, fillcolor="#ccffcc"];
    device_2 [label="192.168.10.120\nControl Devi...", shape=ellipse, style=filled, fillcolor="#ffcccc"];
    device_3 [label="192.168.10.140\nField Device", shape=box, style=filled, fillcolor="#ccffcc"];
    device_4 [label="192.168.10.62\nNetwork Devi...", shape=diamond, style=filled, fillcolor="#ccccff"];
    device_5 [label="192.168.10.23\nNetwork Devi...", shape=diamond, style=filled, fillcolor="#ccccff"];
    device_6 [label="192.168.10.204\nNetwork Devi...", shape=diamond, style=filled, fillcolor="#ccccff"];
    device_7 [label="141.81.0.10\nNetwork Devi...", shape=diamond, style=filled, fillcolor="#ccccff"];
    device_8 [label="141.81.0.23\nControl Devi...", shape=ellipse, style=filled, fillcolor="#ffcccc"];
    device_9 [label="141.81.0.63\nControl Devi...", shape=ellipse, style=filled, fillcolor="#ffcccc"];
    device_10 [label="141.81.0.43\nControl Devi...", shape=ellipse, style=filled, fillcolor="#ffcccc"];
    device_11 [label="141.81.0.83\nControl Devi...", shape=ellipse, style=filled, fillcolor="#ffcccc"];
    device_12 [label="10.1.1.167\nNetwork Devi...", shape=diamond, style=filled, fillcolor="#ccccff"];
    device_13 [label="10.1.1.164\nControl Devi...", shape=ellipse, style=filled, fillcolor="#ffcccc"];
    device_14 [label="192.168.1.22\nPLC", shape=octagon, style=filled, fillcolor="#ffddff"];
    device_15 [label="192.168.1.30\nField Device", shape=box, style=filled, fillcolor="#ccffcc"];
    device_16 [label="192.168.1.24\nPLC", shape=octagon, style=filled, fillcolor="#ffddff"];
    device_17 [label="192.168.1.69\nNetwork Devi...", shape=diamond, style=filled, fillcolor="#ccccff"];
  }

  // Hierarchical network connections
  internet -> gateway_router [label="WAN"];
  gateway_router -> core_net0 [label="Route"];
  gateway_router -> agg_net0 [label="Route"];
  gateway_router -> agg_net1 [label="Route"];
  gateway_router -> agg_net2 [label="Route"];
  gateway_router -> agg_net3 [label="Route"];
  core_net0 -> device_0 [label="L2"];
  core_net0 -> device_1 [label="L2"];
  core_net0 -> device_2 [label="L2"];
  core_net0 -> device_3 [label="L2"];
  core_net0 -> device_4 [label="L2"];
  core_net0 -> device_5 [label="L2"];
  agg_net0 -> device_6 [label="L2"];
  agg_net1 -> device_7 [label="L2"];
  agg_net1 -> device_8 [label="L2"];
  agg_net1 -> device_9 [label="L2"];
  agg_net1 -> device_10 [label="L2"];
  agg_net1 -> device_11 [label="L2"];
  agg_net2 -> device_12 [label="L2"];
  agg_net2 -> device_13 [label="L2"];
  agg_net3 -> device_14 [label="L2"];
  agg_net3 -> device_15 [label="L2"];
  agg_net3 -> device_16 [label="L2"];
  agg_net3 -> device_17 [label="L2"];

  // Legend: Device Shapes
  subgraph cluster_legend {
    rank=sink;
    label="Device Legend";
    style=filled;
    fillcolor="#f9f9f9";
    fontsize=12;

    legend_plc [label="PLC", shape=octagon, style=filled, fillcolor="#ffddff"];
    legend_field [label="Field Device", shape=box, style=filled, fillcolor="#ccffcc"];
    legend_control [label="Control Device", shape=ellipse, style=filled, fillcolor="#ffcccc"];
    legend_network [label="Network Device", shape=diamond, style=filled, fillcolor="#ccccff"];
    legend_unknown [label="Unknown Device", shape=circle, style=filled, fillcolor="#f0f0f0"];
  }
}
